@using Microsoft.AspNetCore.Identity
@using MicroSocialPlatform.Models
@using MicroSocialPlatform.Helpers

@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

@if (SignInManager.IsSignedIn(User))
{
    var user = await UserManager.GetUserAsync(User);
    var initials = AvatarHelper.GetInitials(user?.FullName);
    var hasProfilePicture = !string.IsNullOrEmpty(user?.ProfilePicture);

    <!-- utilizator autentificat -->
    <div class="user-menu-wrapper">
        <div class="dropdown">
            <button class="user-menu-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <div class="user-avatar-small">
                    @if (hasProfilePicture)
                    {
                        <img src="@user.ProfilePicture"
                             alt="@user.FullName"
                             class="avatar-img" />
                    }
                    else
                    {
                        <span class="avatar-initials">@initials</span>
                    }
                </div>
                <span class="user-name d-none d-md-inline">@user?.FullName</span>
                <i class="bi bi-chevron-down"></i>
            </button>

            <!-- restul dropdown-ului -->
            <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg rounded-4 p-2 mt-2"
                style="background-color: #fff; min-width: 200px;">

                <li class="px-3 py-2 border-bottom mb-2">
                    <div class="fw-bold text-dark">@User.Identity?.Name</div>
                    <small class="text-muted" style="font-size: 0.8rem;">Contul tău</small>
                </li>

                <li>
                    <a class="dropdown-item rounded-3 py-2 d-flex align-items-center gap-2"
                       asp-area="" asp-controller="Profile" asp-action="Index"
                       style="color: #6c757d; transition: all 0.2s;">
                        <i class="bi bi-person fs-5" style="color: #8e44ad;"></i> Profil
                    </a>
                </li>

                <li>
                    <a class="dropdown-item rounded-3 py-2 d-flex align-items-center gap-2"
                       asp-area="" asp-controller="Profile" asp-action="Edit" asp-route-id="@UserManager.GetUserId(User)"
                       style="color: #6c757d; transition: all 0.2s;">
                        <i class="bi bi-gear fs-5" style="color: #8e44ad;"></i> Setări
                    </a>
                </li>

                <li><hr class="dropdown-divider my-2"></li>

                <li>
                    <form class="form-inline" asp-controller="Account" asp-action="Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" method="post">
                        <button type="submit" class="dropdown-item rounded-3 py-2 d-flex align-items-center gap-2 text-danger w-100 border-0 bg-transparent">
                            <i class="bi bi-box-arrow-right fs-5"></i> Deconectare
                        </button>
                    </form>
                </li>
            </ul>

            <style>
                .dropdown-item:hover {
                    background-color: #f3e5f5 !important; 
                    color: #8e44ad !important; 
                }
            </style>
        </div>
    </div>
}
else
{
    <!-- utilizator neautentificat -->
    <div class="auth-buttons">
        <a asp-controller="Account" asp-action="Login" class="btn btn-outline-primary btn-sm">
            <i class="bi bi-box-arrow-in-right"></i>
            <span class="d-none d-md-inline">Login</span>
        </a>
        <a asp-controller="Account" asp-action="Register" class="btn btn-primary btn-sm">
            <i class="bi bi-person-plus"></i>
            <span class="d-none d-md-inline">Sign Up</span>
        </a>
    </div>
}